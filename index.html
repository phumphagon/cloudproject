<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RaPunSale</title>
  <link rel="stylesheet" href="CSS/index.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>

  <!-- Top Bar -->
  <header class="top-bar">
    <div class="lang">üåê TH | ‡πÑ‡∏ó‡∏¢</div>
    <div class="user-info" id="userInfo">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  </header>

  <!-- Logo + Search -->
  <section class="top-section">
    <div class="logo-area">
      <img src="image/logo.png" alt="logo" class="logo-img" />
      <h1>RaPunSale</h1>
    </div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." oninput="filterProducts()" />
      <button><i class="fas fa-search"></i></button>
    </div>
  </section>

  <!-- ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà -->
<nav class="menu-bar">
  <a class="active">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
  <a href="customertracking.html">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</a>
  <a href="dashboard.html" id="dashboardLink" style="display: none;">Dashboard</a>
</nav>


  <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î -->
  <section class="product-container" id="productContainer">
    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
  </section>

  <script>
    const apiUrl = "https://dg4t1cf76l.execute-api.us-east-1.amazonaws.com/get-products";
    let allProducts = [];

    function fetchProducts() {
      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          allProducts = data;
          displayProducts(data);
        })
        .catch(err => {
          console.error("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
        });
    }

    function displayProducts(products) {
      const container = document.getElementById("productContainer");
      container.innerHTML = "";

      products.forEach(item => {
        const card = document.createElement("div");
        card.className = "product-card";

        if (item.stock <= 0) {
          card.classList.add("out-of-stock");
        } else if (item.stock <= 3) {
          card.classList.add("low-stock");
        }

        let stockStatus = "";
        if (item.stock <= 0) {
          stockStatus = `<i class="fa fa-times" style="color:red"></i> <span style="color:red">‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${item.stock}</span>`;
        } else if (item.stock <= 3) {
          stockStatus = `<i class="fa fa-exclamation-triangle" style="color:#ff5900"></i> <span style="color:#ff5900">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${item.stock}</span>`;
        } else {
          stockStatus = `<i class="fa fa-check" style="color:green"></i> <span style="color:green">‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${item.stock}</span>`;
        }

        card.innerHTML = `
          <img src="${item.picture}" alt="${item.name}" />
          <div class="product-info">
            <p class="name">${item.name}</p>
            <p class="stock">${stockStatus}</p>
            <p class="price">${item.price} <span>‡∏ö‡∏≤‡∏ó</span></p>
          </div>
          <button class="update-btn" onclick="editProduct('${item.productId}')">Update ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        `;

        container.appendChild(card);
      });
    }

    function filterProducts() {
      const keyword = document.getElementById("searchInput").value.toLowerCase();
      const filtered = allProducts.filter(p => p.name.toLowerCase().includes(keyword));
      displayProducts(filtered);
    }

    function editProduct(id) {
      window.location.href = `index2.html?productId=${id}`;
    }

   function showUser() {
  const name = localStorage.getItem("name");
  const role = localStorage.getItem("role");
  const userInfo = document.getElementById("userInfo");

  if (!name || !role) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
    window.location.href = "login.html";
    return;
  }

  userInfo.innerHTML = `
  <i class="fa fa-user-circle"></i> ${name} (${role})
  <a href="#" onclick="logout()" style="color: yellow; margin-left: 1vw;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>`;

  // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Dashboard ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin
  if (role === "admin") {
    const dashboardLink = document.getElementById("dashboardLink");
    if (dashboardLink) dashboardLink.style.display = "inline-block";
  }
 }


    function logout() {
      localStorage.clear();
      window.location.href = "login.html";
    }

    document.addEventListener("DOMContentLoaded", () => {
      showUser();
      fetchProducts();
    });
  </script>

</body>
</html>
